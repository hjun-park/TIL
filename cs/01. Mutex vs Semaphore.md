# Mutex vs Semaphore

## 1. êµì°©ìƒíƒœ (deadlock)
- ë‘ ê°€ì§€ ì´ìƒì˜ ì‘ì—…ì´ ì„œë¡œ ìƒëŒ€ë°©ì˜ ì‘ì—…ì´ ëë‚˜ê¸°ë§Œì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ

## 2. ì„ê³„ì˜ì—­
- ì—¬ëŸ¬ ì‘ì—…ë“¤ì´ ë¦¬ì†ŒìŠ¤ë¥¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³µìœ  ê³µê°„
- í•œ ì‘ì—…ì´ ìì›ì„ ì ìœ í•˜ë©´ ë‹¤ë¥¸ ì‘ì—…ì€ ê·¸ ìì›ì„ ì‚¬ìš©í•˜ë ¤ë©´ ê·¸ ìì›ì„ ì ìœ í•œ ì‘ì—…ì´ ì¢…ë£Œë˜ê¸°ê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.

## 3. Deadlock 4ê°€ì§€ ì¡°ê±´
- `Mutual Exclusion (ìƒí˜¸ ë°°ì œ)` : í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ìì›ì„ ì ìœ í•˜ë©´ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì ìœ í•  ìˆ˜ ì—†ë‹¤. 
- `Hold and Wait (ì ìœ ì™€ ëŒ€ê¸°)` : í•œ ìì›ì„ ì ìœ í•˜ë©´ì„œ ë‹¤ë¥¸ ìì›ì„ ì–»ê¸°ê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ê²½ìš°
- `No Preemption (ë¹„ì„ ì )` : ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ì ìœ í•˜ê³  ìˆëŠ” ìì›ì„ ê°•ì œë¡œ ëºì„ ìˆ˜ ì—†ë‹¤.
- `Circular Wait (ìˆœí™˜ ëŒ€ê¸°)` : ê° í”„ë¡œì„¸ìŠ¤ëŠ” ìˆœí™˜ì ìœ¼ë¡œ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ê°€ ê°€ì§€ê³  ìˆëŠ” ìì›ì„ ìš”êµ¬í•œë‹¤.

## 4. Mutex
- ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¥¼ ì‹¤í–‰í•˜ëŠ” í™˜ê²½ì—ì„œ ìì›ì— ëŒ€í•œ ì ‘ê·¼ ì œì–´ë¥¼ ìœ„í•´ ì‚¬ìš©

### 4-1 ì‹¤ìƒí™œ Mutex ì˜ˆì‹œ
Example) í™”ì¥ì‹¤ì— ìˆëŠ” ìœ ì¼í•œ ë³€ê¸°ì¹¸(ê³µìœ ëœ ìì›)

1. ëŒ€ë³€ì´ ë§ˆë ¤ìš´ í•œëª…ì´ ë³€ê¸°ì¹¸ì— ë“¤ì–´ê°„ë‹¤.
2. ë“¤ì–´ê°„ ì‚¬ëŒì€ ì´ì œ ë³€ê¸°ì¹¸ì— ë‹¤ë¥¸ ì‚¬ëŒì´ ë“¤ì–´ì˜¤ì§€ ëª»í•˜ë„ë¡ ë¬¸ì„ ê±¸ì–´ ì ê·¼ë‹¤. (`Lock` íšë“)
3. ëŒ€ë³€ì´ ë§ˆë ¤ìš´ ìƒˆë¡œìš´ ì‚¬ëŒì´ í™”ì¥ì‹¤ ë„ì°©, ìœ ì¼í•œ ë³€ê¸°ì¹¸ì— ì§„ì…ì„ ì‹œë„í•œë‹¤.
4. ê¸°ì¡´ì— ë“¤ì–´ê°„ ì‚¬ëŒì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.
5. ê¸°ì¡´ì— ë“¤ì–´ê°„ ì‚¬ëŒì´ ë‚˜ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ì‚¬ëŒì€ ê³„ì†í•´ì„œ ë” ì¦ê°€í•œë‹¤.

#### ğŸ”µ ì •ë¦¬  
```markdown
ì„ê³„ ì˜ì—­ì— ìŠ¤ë ˆë“œ(ì‚¬ëŒ)ê°€ ìˆì„ ê²½ìš° ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ê³µìœ  ìì›(ë³€ê¸°ì¹¸)ì„ ì‚¬ìš©í•˜ë ¤ê³  í•œë‹¤ë©´
ìŠ¤ë ˆë“œ(ê·¸ ì‚¬ëŒ)ë¥¼ Blockingí•˜ê³  ëŒ€ê¸°í(í™”ì¥ì‹¤ ë¬¸ ì•)ì— Sleep ì‹œí‚¨ë‹¤.
```
- `ëŒ€ë³€ì´ ë§ˆë ¤ìš´ ìƒˆë¡œìš´ ì‚¬ëŒ` : `thread`
- `ê±¸ì–´ ì ê·¼ë‹¤` : `Lock`
- `ëŒ€ë³€ì´ ë§ˆë ¤ì›€` : `critical section`
- `ìœ ì¼í•œ ë³€ê¸°ì¹¸` : `shared resource`

### 4-2. Mutex ì˜ˆì‹œì½”ë“œ in JAVA
```java
public class Mutex {
    private boolean isLocked = false;

    public synchronized void lock() throws InterruptedException {
        while (isLocked) {
            wait();
        }
        isLocked = true;
    }

    public synchronized void unlock() {
        isLocked = false;
        notify();
    }
}
```

### 4-3. Spin Lock
- `Lock`ì„ íšë“í•˜ê¸° ìœ„í•´ ê³„ì†í•´ì„œ `Lock`ì„ í™•ì¸í•˜ëŠ” ë°©ì‹
- `Thread`ì˜ `Context Switch`ê°€ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— `Context Switching`ì´ ì§§ì„ ë•Œ ì‚¬ìš©
- ë©€í‹°ì½”ì–´ í”„ë¡œì„¸ìŠ¤ í™˜ê²½ì—ì„œëŠ” `Spin Lock`ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì´ë‹¤.


## 5. Semaphore
- ë©€í‹° í”„ë¡œê·¸ë˜ë° í™˜ê²½ì—ì„œ ì—¬ëŸ¬ ê°œì˜ í”„ë¡œì„¸ìŠ¤ í˜¹ì€ ìŠ¤ë ˆë“œì˜ ê³µìœ  ìì›ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œí•œí•˜ëŠ” ë°©ë²•
- Mutexì™€ëŠ” ë‹¤ë¥´ê²Œ ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ ì ‘ê·¼ ê°€ëŠ¥

- Example) í™”ì¥ì‹¤ ë³€ê¸° ì¹¸ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°

1. ìµœëŒ€ 3ëª…ê¹Œì§€ ìˆ˜ìš© ê°€ëŠ¥, ë‹¤ ì ìœ ì‹œ 0ìœ¼ë¡œ í‘œì‹œ
2. ë³€ê¸° ì¹¸ì— ë“¤ì–´ê°€ëŠ” ì‚¬ëŒì€ P, ë³€ê¸° ì¹¸ì—ì„œ ë‚˜ê°€ëŠ” ì‚¬ëŒì€ V
3. P = ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„, V = ë³¼ ì¼ ë‹¤ ë³¸ ì‚¬ëŒ
4. ëŒ€ê¸°ìê°€ ë³€ê¸°ì— ì§„ì…í•œ ë’¤ì— ë˜ ë‹¤ë¥¸ ëŒ€ê¸°ìê°€ ë‚˜íƒ€ë‚˜ëŠ” ê²½ìš°
   - Sleep waiting -> ë¹ˆ ìë¦¬ê°€ ìƒê²¨ë‚˜ë©´ sleep ëœ ë³€ê¸° ëŒ€ê¸°ìë¥¼ ê¹¨ìš´ë‹¤.
   - Busy waiting  -> ì‚¬ìš© ê°€ëŠ¥í•œ ìë¦¬ê°€ ìƒê¸¸ ë•Œê¹Œì§€ ë¹ˆ ìë¦¬ê°€ ìˆëƒê³  ë¬¼ì–´ë³¸ë‹¤.
5. ë‚¨ì€ ìë¦¬ê°€ ìŒìˆ˜ì´ë©´ ìŒìˆ˜ì˜ ìˆ˜ ë§Œí¼ ì‚¬ëŒì´ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

### 5-1. Semaphore ì˜ˆì‹œì½”ë“œ in JAVA
```java
public class Semaphore {
    private int value;

    public Semaphore(int value) {
        this.value = value;
    }

    public synchronized void P() throws InterruptedException {
        while (value == 0) {
            wait();
        }
        value--;
    }

    public synchronized void V() {
        value++;
        notify();
    }
}
```


## 6. ê·¸ë˜ì„œ `Mutex` `Spin lock` `Semaphore`ë€ ? 
1) Mutex
   - ì—¬ëŸ¬ threadë¥¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ì—ì„œ ìì›ì— ëŒ€í•œ ì ‘ê·¼ì„ ê°•ì œí•˜ê¸° ìœ„í•œ ë™ê¸°í™” ë°©ë²•
   - Boolean íƒ€ì… Lock ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  Lockì„ ì–»ì€ threadë§Œ í•´ì œ ê°€ëŠ¥
   - ë‹¤ë¥¸ threadê°€ ìì›ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ ê³µìœ  ìì›ì— ì ‘ê·¼ ì‹œ Blocking í›„ì— ëŒ€ê¸° íë¡œ ë³´ë‚¸ë‹¤.

<br />

2) Spin Lock
   - Mutexì™€ ìœ ì‚¬í•˜ì§€ë§Œ blocking í•˜ì§€ ì•Šê³  busy-waiting
   - Waiting Queueë¥¼ ê°–ì§€ ì•ŠìŒ (mutexì˜ non-blocking ë²„ì „)

<br />

3) Semaphore
   - ì„¸ë§ˆí¬ì–´ ë³€ìˆ˜ë¥¼ í†µí•´ wait, signal ê´€ë¦¬í•œë‹¤.
   - ì„¸ë§ˆí¬ì–´ ë³€ìˆ˜ëŠ” 0 ì´ìƒì˜ ì •ìˆ˜í˜• ë³€ìˆ˜ë¥¼ ê°–ëŠ”ë‹¤.
   - ì ‘ê·¼ ê°€ëŠ¥í•œ ê³µìœ  ìì›ì˜ ìˆ˜ê°€ 1ê°œë¼ë©´ binary `semaphore`ë¡œ  `Mutex`ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
   - Lockì„ ê±¸ì§€ ì•Šì€ Threadë„ Signalì„ ë³´ë‚´ Lockì„ ì–»ê²Œí•  ìˆ˜ ìˆë‹¤.

## ì¶œì²˜
1. [[java/ê°œë…] ì„¸ë§ˆí¬ì–´(Semaphore)ì™€ ë®¤í…ìŠ¤(Mutex)](https://drcode-devblog.tistory.com/297)