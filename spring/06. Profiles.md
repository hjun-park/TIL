# 06. Profiles

# 1. Profile ?

- ìŠ¤í”„ë§ ì½”ì–´ ê¸°ëŠ¥ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆì„ dev, prod, test ì²˜ëŸ¼ ì„œë¡œ ë‹¤ë¥¸ í”„ë¡œí•„ì— ë§¤í•‘í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
- Bean ìœ„ì— `@Profile`ì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œí•„ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

## 1-1. Spring profiles ì‚¬ìš©

#### ğŸ”µ @Profile ì˜ˆì‹œ

```java

@Component
@Profile("dev")
public class DevDatasourceConfig {
}

// -- NOT ì¡°ê±´ë„ ë„£ì„ ìˆ˜ ìˆë‹¤.
@Component
@Profile("!dev")
public class DevDatasourceConfig {
}
```

<br />

#### ğŸ”µ JVMì—ì„œ í˜„ì¬ í”„ë¡œí•„ ì„¤ì •í•˜ê¸°

```markdown
-Dspring.profiles.active="prod"
```

<br />

#### ğŸ”µ í…ŒìŠ¤íŠ¸ì½”ë“œ í”„ë¡œí•„ ì„¤ì •í•˜ê¸°

```java
@ActiveProfiles("test")
```

## 1-2. í˜„ì¬ í”„ë¡œí•„ ì–»ì–´ì˜¤ê¸°

#### ğŸ”µ Environment ì‚¬ìš©

```java
public class ProfileManager {
    @Autowired
    private Environment environment;

    public void getActiveProfiles() {
        for (String profileName : environment.getActiveProfiles()) {
            System.out.println("Currently active profile - " + profileName);
        }
    }
}
```

<br />

#### ğŸ”µ `spring.profiles.active` í”„ë¡œí¼í‹°

```java
public class ProfileManager {
    @Value("${spring.profiles.active}")
    private String activeProfile;

    public void getActiveProfiles() {
        System.out.println("Currently active profile - " + activeProfile);
    }
}
```

<br />

#### ğŸ”µ active ëœ í”„ë¡œí•„ì´ ì—†ë‹¤ë©´ ?

- `IllegalArgumentException` ë°œìƒ
- ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©

```java
public class ProfileManager {
    @Value("${spring.profiles.active:}")
    private String activeProfiles;

    public String getActiveProfiles() {
        for (String profileName : activeProfiles.split(",")) {
            System.out.println("Currently active profile - " + profileName);
        }
    }
}
```

<br />

## 1-3. Active Profile ì¶”ê°€ ë°©ë²•

#### ğŸ”µ `application.properties`ì— ì¶”ê°€

```properties
spring.profiles:prod
spring.profiles.include:proddb, prodmq
```

<br />

## 1-4. yml íŒŒì¼ì—ì„œ Profile ì„¤ì •
- ì˜ ì •ë¦¬ëœ ë¸”ë¡œê·¸ : https://zzang9ha.tistory.com/415

```yaml
spring:
  profiles:
    active:
      - local
    group:
      local:
        - site-local
        - db-local
      dev:
        - site-dev
        - db-dev
    include:
      - db
      - my-service
      - site
```

## ì¶œì²˜

1. [[Baeldung]spring-profiles](https://www.baeldung.com/spring-profiles)
2. [[zzang9ha]Spring Boot profiles ì„¤ì •í•˜ê¸°](https://zzang9ha.tistory.com/415)